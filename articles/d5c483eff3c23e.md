---
title: "[SwiftUI] iOS17におけるMapKitの使い方"
emoji: "📘"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [swiftui]
published: false
---
iOS17ではSwiftUIで簡単にマップの実装ができます。日本語の情報が少なかったので、マップの基本的な機能の実装をまとめました。

# マップの表示

Map()と書くだけで簡単にマップを表示できます。

```swift
import SwiftUI
import MapKit

struct ContentView: View {
    var body: some View {
        Map()
    }
}
```

## 見た目を変える

マップの見た目は以下のように指定します。

```swift
struct ContentView: View {
    // マップに適用するスタイル
    @State var mapStyle: MapStyle = .standard(elevation: .automatic, emphasis: .automatic,,pointsOfInterest: .all, showsTraffic: false)

    var body: some View {
        Map()
            .mapStyle(mapStyle)
    }
}
```

```swift
static func standard(
    elevation: MapStyle.Elevation = .automatic,
    emphasis: MapStyle.StandardEmphasis = .automatic,
    pointsOfInterest: PointOfInterestCategories = .all,
    showsTraffic: Bool = false
) -> MapStyle
```

standardはMapStyleのstatic関数で返り値がMapStyleになっており、マップに適用するスタイルを作成できます。MapStyleを指定するstatic関数は以下のものがあり、使用する関数によってマップの見た目が大きく変わります。

| 関数 | 見た目 |
| --- | --- |
| standard | 標準的なマップ |
| imagery | 衛星写真で表示されるマップ |
| hybrid | 上記の2つを合わせたマップ |



| 引数 | 型 | 使える関数 | 説明 |
| --- | --- | --- | --- |
| elevation | MapStyle.Elevation | 全て | 標高をレンダリングするか |
| emphasis | MapStyle.StandardEmphasis | standardのみ | レストランなどのピンをどう強調するか |
| pointsOfInterest | PointOfInterestCategories | standardとhybrid | マップに表示するPOI。これを使えばPOIフィルタリングができる |
| showsTraffic | Bool | standardとhybrid | 交通量を表示するか。交通量の多い道路は赤色や黄色になる |

| MapStyle.Elevation | 説明 |
| --- | --- |
| automatic | デフォルト。たぶんflatと同じ |
| flat | 平坦な2Dになる | 
| realistic | 標高が表示され3Dになる |

| MapStyle.StandardEmphasis | 説明 |
| --- | --- |
| automatic | デフォルト |
| muted | もともと表示されているレストランなどのピンが少し暗くなる |

POIフィルタリングについては以下のサイトが参考になります。
https://qiita.com/MilanistaDev/items/bf8cd5cf01b9ba965148

# ピンを置く

Markerは吹き出しのようなシンプルなピンを作成します。吹き出しに表示される画像を変更するぐらいしかカスタムできません。Annotationはピンとして表示されるコンテンツを自分で作成することができます。

```swift
struct Place {
    let name: String    // 場所の名前
    let coordinate: CLLocationCoordinate2D  // 場所の座標
}

struct ContentView: View {
    @State var place: Place

    var body: some View {
        Map() {
            Marker(place.name, coordinate: place.coordinate)
            // 画像を変更
            Marker(place.name, systemImage: "car", coordinate: place.coordinate)

            Annotation(place.name, coordinate: place.coordinate) {
                HStack {
                    Image(systemName: "car")
                    Text(place.name)
                }
            }
            // ピンの下に表示されるタイトルを非表示する
            .annotationTitles(.hidden)
        }
    }
}
```

# マップ上のピンを選択可能にする

もともと表示されているレストランや学校などのピンを選択可能にするには、まずMapの引数selectionにMapFeature型の変数をバインディングします。ピンを選択すると、選択された場所の情報が変数selectionに格納されます。

```swift
struct ContentView: View {
    @State var selection: MapFeature?

    var body: some View {
        Map(selection: $selection)
            .mapFeatureSelectionContent() { mapFeature in
                // 選択された場所の情報をMapFeature型の引数として得られる
                // 何も書かない場合、デフォルトのマーカーが適用される
                // MarKerやAnnotationを使ってピンを変更できる
            }
            .mapFeatureSelectionDisabled() { mapFeature in
                // 選択された場所の情報をMapFeature型の引数として得られる
                // 選択を無効にしたい場合はtrueを返す
                // falseであれば選択可能になる
                return false
            }
    }
}
```

```swift
func mapFeatureSelectionContent(@MapContentBuilder content: @escaping (MapFeature) -> some MapContent) -> some View
```

```swift
func mapFeatureSelectionDisabled(_ selectionDisabled: @escaping (MapFeature) -> Bool) -> some View
```

## 自分で作成したピンも選択可能にする

自分で作成したピンは自作struct・class